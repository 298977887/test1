name: Build/release Electron app

on:
  push:
    branches:
      - main
    paths-ignore:
      - '**.md'
    tags-ignore:
      - 'v*'
  workflow_dispatch:

jobs:
  release:
    runs-on: ${{ matrix.os }}
    
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]

    steps:
      - name: Check out Git repository
        uses: actions/checkout@v3

      - name: Install Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Clear npm cache
        run: npm cache clean --force

      - name: Install Dependencies
        run: npm install

      - name: build-linux
        if: matrix.os == 'ubuntu-latest'
        run: npm run build:linux

      - name: build-mac
        if: matrix.os == 'macos-latest'
        run: npm run build:mac

      - name: build-win
        if: matrix.os == 'windows-latest'
        run: npm run build:win

      - name: release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: "v20250411.1"
          draft: false
          #name: "EchoMirror å‘å¸ƒ ${{ env.VERSION }}"
          body: |
            # Echo Mirror æ™ºèƒ½é­”é•œ
            
            ## ğŸ“¦ å‘å¸ƒå†…å®¹
            
            æ­¤ç‰ˆæœ¬åŒ…å«ä»¥ä¸‹å®‰è£…åŒ…ï¼Œè¯·æ ¹æ®æ‚¨çš„æ“ä½œç³»ç»Ÿé€‰æ‹©å¯¹åº”çš„æ–‡ä»¶ï¼š
            
            ### Windows
            - **Windowså®‰è£…åŒ…** (.exeæ–‡ä»¶) - Windows 10/11
            
            ### macOS
            - **macOSå®‰è£…åŒ…** (.dmgæ–‡ä»¶) - å…¼å®¹Intel/Apple SiliconèŠ¯ç‰‡
            
            ### Linux
            - **AppImageæ–‡ä»¶** - é€‚ç”¨äºå¤§å¤šæ•°Linuxå‘è¡Œç‰ˆ
            - **DEBå®‰è£…åŒ…** - Debian/Ubuntuç³»åˆ—
            
            ## ğŸ“‹ å®‰è£…è¯´æ˜
            
            1. ä¸‹è½½å¯¹åº”æ‚¨ç³»ç»Ÿçš„å®‰è£…åŒ…
            2. è¿è¡Œå®‰è£…ç¨‹åºå¹¶æŒ‰ç…§æç¤ºå®Œæˆå®‰è£…
            3. å¯åŠ¨Echo Mirrorï¼Œå¼€å§‹äº«å—æ‚¨çš„æ™ºèƒ½é­”é•œä½“éªŒ
            
            ## ğŸ”— ç›¸å…³é“¾æ¥
            
            - [å®˜æ–¹ç½‘ç«™](https://mirror.aoun.ltd/)
            - [é¡¹ç›®ä¸»é¡µ](https://github.com/298977887/EchoMirror)
            - [é—®é¢˜åé¦ˆ](https://github.com/298977887/EchoMirror/issues)
            - [ä½¿ç”¨æ–‡æ¡£](https://github.com/298977887/EchoMirror/wiki)
          files: |
            dist/*.exe
            dist/*.zip
            dist/*.dmg
            dist/*.AppImage
            dist/*.snap
            dist/*.deb
            dist/*.rpm
            dist/*.tar.gz
            dist/*.yml
            dist/*.blockmap
        env:
          GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}
